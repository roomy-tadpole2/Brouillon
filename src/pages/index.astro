---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import HomeStyles from './HomeStyle.astro';
import HomeScripts from './HomeScripts.astro';

// 获取所有有封面图的博客文章作为候选池
const allPosts = (await getCollection('blog')).filter(post => post.data.heroImage);
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
    <main>
        <section class="home-header">
            <h1 class="home-title">Le brouillon d'Adam</h1>
        </section>

        <section class="cards-section">
            <div class="cards-container" id="cards-container">
                {
                    allPosts.map((post) => (
                        <div 
                            class="home-card" 
                            style="display: none; visibility: hidden;" 
                            data-post-id={post.id}
                        >
                            <a href={`/blog/${post.id}/`}>
                                {post.data.heroImage && (
                                    <Image 
                                        width={1200} 
                                        height={1200} 
                                        quality={100}
                                        format="png"
                                        src={post.data.heroImage} 
                                        alt={post.data.title}
                                        transition:name={`hero-${post.id}`} 
                                    />
                                )}
                            </a>
                        </div>
                    ))
                }
            </div>
        </section>
    </main>

    <HomeStyles />
    <HomeScripts />
</BaseLayout>